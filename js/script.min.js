function regLogin(){var e=$("#loginEmail").val(),a=$("#loginPassword").val(),t=$("#token").val();if($("#autologin").is(":checked"))var i=1;else var i=0;$.ajax({url:"resources/handler/login.php",data:{event:"logIn",token:t,email:e,password:a,autoLogin:i},type:"POST",dataType:"json"}).done(function(e){if(e.constructor===Array)if("Error"==e[0])Materialize.toast(e[1],4e3,"rounded");else for(var a=0;a<e.length;a++){$("#"+e[a]).toggleClass("invalid valid");var t=$("#"+e[a]).siblings("label").text();Materialize.toast(t+" has been typed wrong",4e3,"rounded")}else 1===e.status?location.href="home.php":3===e.status?location.href="verifyMail.php":"Wrong Email or Password"==e.message?(Materialize.toast(e.message,4e3,"rounded"),$("#loginEmail, #loginPassword").toggleClass("invalid valid")):Materialize.toast(e.message,4e3,"rounded")}).fail(function(e){console.log(e)})}function regSignup(){1==$("#signupAgree").prop("checked")?$.ajax({url:"resources/handler/create.php",data:$("#signupBox").serialize(),type:"POST",dataType:"json"}).done(function(e){var a=$("#signupEmail").val();if(e.constructor===Array)if("Error"==e[0])Materialize.toast(e[1],4e3,"rounded");else for(var t=0;t<e.length;t++){$("input[name='"+e[t]+"']").toggleClass("invalid valid");var i=$("input[name='"+e[t]+"']").siblings("label").text();Materialize.toast(i+" has been typed wrong",4e3,"rounded")}else 1===e.status?location.href="home.php":3===e.status&&Materialize.toast("A validation email has been sent to "+a+". If you cant find it, please check your SPAM folder.",4e3,"rounded",function(){location.href="verifyMail.php"})}).fail(function(e){console.log(e)}):Materialize.toast("You have to accept the License agreements!",4e3,"rounded")}function regEdit(){$.ajax({url:"resources/handler/edit.php",data:$("#editBox").serialize(),type:"POST",dataType:"json"}).done(function(e){if(0===e.length)Materialize.toast("Successfully Saved",4e3,"rounded");else if("emailSend"===e[0])Materialize.toast("An validationemail has been send to your new submitted emailaddress. If you cant find it, please check your SPAM folder.",6e3,"rounded");else if("Error"==e[0])Materialize.toast(e[1],4e3,"rounded");else for(var a=0;a<e.length;a++){$("input[name='"+e[a]+"']").toggleClass("invalid valid");var t=$("input[name='"+e[a]+"']").siblings("label").text();Materialize.toast(t+" has been typed wrong",4e3,"rounded")}}).fail(function(e){console.log(e)})}function getPageName(e){var a=e.lastIndexOf("/")+1,t=e.substr(a),i=t.split(".")[0];return i}function redirect(e){location.href=e}function triggerUpdateEmail(e){$("#updateEmailSpan").html(e),$("#modalUpdateEmail").modal("open")}function updateEmail(){var e=$("#token").val();$.ajax({url:"resources/handler/login.php",data:{event:"updatePrimaryEmail",token:e},type:"POST",dataType:"json"}).done(function(e){1==e?($("#modalUpdateEmail").modal("close"),Materialize.toast("Your primary email address was updated",4e3,"rounded"),Materialize.toast("Redirecting ...",4e3,"rounded",function(){location.href="home.php"})):Materialize.toast("Sorry, unexpected error accured!",4e3,"rounded",function(){location.href="home.php"})}).fail(function(e){console.log(e)})}var extension=".php",pageName=getPageName(window.location.href)+extension;$(document).ready(function(){$(".modal").modal({dismissible:!0,opacity:.5,in_duration:300,out_duration:200,starting_top:"4%",ending_top:"10%"}),$("select").material_select();var e=new Date,a="31/12/"+e.getFullYear();$(".datepicker").pickadate({selectMonths:!0,selectYears:75,format:"dd/mm/yyyy",min:[1940,1,1],max:a,closeOnClear:!0,today:"",clear:"",close:"Cancel",onSet:function(e){"select"in e&&this.close()}}),$(".tooltipped").tooltip({delay:50}),$("#autocomplete-country").autocomplete({data:{Denmark:null,"Faroe Islands":null,Greenland:null}}),$(".button-collapse").sideNav({menuWidth:300,edge:"left",closeOnClick:!1,draggable:!0}),Materialize.updateTextFields()}),$("#uAddressZip, #uAddressCity").on("change",function(){var e=$(this).val(),a=$(this).attr("id"),t="uAddressZip"==a?"uAddressCity":"uAddressZip",i=$("#token").val();$.ajax({url:"resources/handler/"+pageName,data:{event:a,zipCity:e,token:i},type:"POST",dataType:"json"}).done(function(e){1==e.status?($("#"+t).val(e.name),$("#uAddressZipCityId").val(e.id),$("#uAddressZip, #uAddressCity").addClass("valid"),$(function(){Materialize.updateTextFields()})):($("#"+t).addClass("invalid"),$("#"+t).val(""))}).fail(function(e){console.log(e)})}),$("#signupEmail, #editEmail").on("change",function(){var e=$(this).val(),a=$("#token").val();""!=e&&$.ajax({url:"resources/handler/"+pageName,data:{event:"checkEmail",email:e,token:a},type:"POST"}).done(function(a){1==a?($("#signupEmail, #editEmail").toggleClass("invalid valid"),$("#modalMerge").modal("open"),$("#modalMergeButton").attr("href","merge.php?email="+e)):2==a?Materialize.toast("Indtast en gyldig email!",4e3,"rounded"):3==a&&($("#signupEmail, #editEmail").toggleClass("invalid valid"),Materialize.toast("This email is already in use!",4e3,"rounded"))}).fail(function(e){console.log(e)})}),$("#signupButton").click(function(){regSignup()}),$(document).on("keyup",function(){var e=event.which;13==e&&("index.php"==pageName?regLogin():"create.php"==pageName?regSignup():"edit.php"==pageName&&regEdit())}),$("#loginButton").click(function(){regLogin()}),$("#editButton").click(function(){regEdit()}),$("#modalUpdateEmailButton").click(function(){updateEmail()});